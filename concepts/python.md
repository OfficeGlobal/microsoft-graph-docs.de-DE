# <a name="get-started-with-microsoft-graph-in-a-python-app"></a><span data-ttu-id="7ffe9-101">Erste Schritte mit Microsoft Graph in einer Python-App</span><span class="sxs-lookup"><span data-stu-id="7ffe9-101">Get started with Microsoft Graph in a Python app</span></span> 

<span data-ttu-id="7ffe9-102">Dieser Artikel beschreibt die erforderlichen Aufgaben zum Abrufen eines Zugriffstokens aus dem Azure AD und zum Aufrufen von Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-102">This article describes the tasks required to get an access token from the v2.0 authentication endpoint and call  Microsoft Graph.</span></span> <span data-ttu-id="7ffe9-103">Sie werden durch das [Senden von E-Mails über Microsoft Graph aus Python](https://github.com/microsoftgraph/python-sample-send-mail) geführt und erhalten Informationen zu den Hauptkonzepten, die Sie zur Verwendung der Microsoft Graph-API implementieren.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-103">It walks you through [Sending mail via Microsoft Graph from Python](https://github.com/microsoftgraph/python-sample-send-mail) and explains the main concepts that you implement to use the Microsoft Graph API.</span></span> <span data-ttu-id="7ffe9-104">In diesem Artikel wird beschrieben, wie Sie mithilfe von direkten REST-Aufrufen auf Microsoft Graph zugreifen.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-104">The article also describes how to access Microsoft Graph by using REST calls.</span></span>

![Formular zum Senden von E-Mails](https://raw.githubusercontent.com/microsoftgraph/python-sample-send-mail/master/static/images/sendmail.png)

## <a name="choosing-an-authentication-library"></a><span data-ttu-id="7ffe9-106">Auswählen einer Authentifizierungsbibliothek</span><span class="sxs-lookup"><span data-stu-id="7ffe9-106">Choosing an authentication library</span></span>

<span data-ttu-id="7ffe9-107">Um Aufrufe an Microsoft Graph ausführen zu können, muss Ihre App ein gültiges Zugriffstoken aus Azure Active Directory (Azure AD), dem Microsoft-Cloudidentitätsdienst, abrufen, und das Token muss in einem HTTP-Header bei jedem Aufruf der Microsoft Graph-REST-API übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-107">To make calls to Microsoft Graph, your app must obtain a valid access token from Azure Active Directory (Azure AD), the Microsoft cloud identity service, and the token must be passed in an HTTP header with each call to the Microsoft Graph REST API.</span></span> <span data-ttu-id="7ffe9-108">Der Authentifizierungsansatz von Graph basiert auf den OAuth 2.0- und Open ID Connect-Standards, es gibt also eine große Auswahl an [Authentifizierungsbibliotheken](https://docs.microsoft.com/de-DE/azure/active-directory/develop/active-directory-v2-libraries) zum Implementieren der Authentifizierung in Ihre Anwendung.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-108">Graph's approach to authentication is based on the OAuth 2.0 and Open ID Connect standards, so there are many [authentication libraries](https://docs.microsoft.com/de-DE/azure/active-directory/develop/active-directory-v2-libraries) that you can choose from to implement authentication in your application.</span></span>

<span data-ttu-id="7ffe9-109">Im folgenden Beispiel wird die [Flask-OAuthlib](https://flask-oauthlib.readthedocs.io/en/latest/)-Bibliothek zum Implementieren des OAuth 2.0-Workflows [Autorisierungscodegenehmigung](https://tools.ietf.org/html/rfc6749#section-4.1) verwendet; dies ist der empfohlene Authentifizierungsworkflow für in Python geschriebene Webanwendungen.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-109">The sample covered below uses the [Flask-OAuthlib](https://flask-oauthlib.readthedocs.io/en/latest/) library to implement OAuth 2.0 [Authorization Code Grant](https://tools.ietf.org/html/rfc6749#section-4.1) workflow, which is the recommended auth workflow for web applications written in Python.</span></span> <span data-ttu-id="7ffe9-110">Informationen zu anderen Authentifizierungsoptionen finden Sie unter [Python-Authentifizierungsbeispiele für Microsoft Graph](https://github.com/microsoftgraph/python-sample-auth).</span><span class="sxs-lookup"><span data-stu-id="7ffe9-110">For information about other authentication options, see [Python authentication samples for Microsoft Graph](https://github.com/microsoftgraph/python-sample-auth).</span></span>

## <a name="installing-and-running-the-send-mail-sample"></a><span data-ttu-id="7ffe9-111">Installieren und Ausführen des Beispiels zum Senden von E-Mails</span><span class="sxs-lookup"><span data-stu-id="7ffe9-111">Installing and running the send-mail sample</span></span>

<span data-ttu-id="7ffe9-112">Zum Installieren und Konfigurieren der Beispiel-App folgen Sie den Anweisungen unter [Installation der Python-REST-Beispiele](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md).</span><span class="sxs-lookup"><span data-stu-id="7ffe9-112">To install and configure the sample app, follow the instructions in [Installing the Python REST samples](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md).</span></span> <span data-ttu-id="7ffe9-113">Verwenden Sie in dem unten dargestellten Beispiel zum Senden von E-Mails den folgenden Befehl zum Klonen des Repositorys.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-113">For the send-mail sample covered below, use this command to clone the repo:</span></span>

    ```git clone https://github.com/microsoftgraph/python-sample-send-mail.git```

<span data-ttu-id="7ffe9-114">Wenn Sie die Anwendung wie in den [Installationsanweisungen](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md) beschrieben registrieren, müssen Sie unbedingt die Berechtigungen **User.Read** und **Mail.Send** einschließen, die für dieses Beispiel erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-114">When you register the application as covered in the [installation instructions](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md), be sure to include the **User.Read** and **Mail.Send** permissions, which are required for this sample.</span></span>

<span data-ttu-id="7ffe9-115">Nach Abschluss der Installation/Konfiguration,können Sie die Beispiel-App ausführen, indem Sie die Anweisungen zum [Ausführen des Beispiels](https://github.com/microsoftgraph/python-sample-send-mail#running-the-sample) befolgen.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-115">After completing the installation/configuration, you can run the sample app by following the instructions for [running the sample](https://github.com/microsoftgraph/python-sample-send-mail#running-the-sample).</span></span>

## <a name="code-walkthrough"></a><span data-ttu-id="7ffe9-116">Exemplarische Vorgehensweise</span><span class="sxs-lookup"><span data-stu-id="7ffe9-116">Code walkthrough</span></span>

<span data-ttu-id="7ffe9-117">Nachfolgend finden Sie eine Übersicht des [Quellcodes](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py) für die Beispiel-App.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-117">The following is an overview of the [source code](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py) for the sample app.</span></span>

<span data-ttu-id="7ffe9-118">Die ersten Codezeilen sind die [Importe](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L4-L11) für die Python-Module und -Pakete, die in dem Beispiel verwendet werden:</span><span class="sxs-lookup"><span data-stu-id="7ffe9-118">The first few lines of code are the [imports](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L4-L11) for the Python modules and packages used in the sample:</span></span>

* <span data-ttu-id="7ffe9-119">Das **base64**-Modul aus der Standardbibliothek wird zum Codieren von E-Mail-Anlagen verwendet.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-119">The **base64** module from the standard library is used for encoding email attachments.</span></span>
* <span data-ttu-id="7ffe9-120">Das **pprint**-Modul aus der Standardbibliothek wird für den Schöndruck von Fehlermeldungen verwendet, die von Graph zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-120">The **pprint** module from the standard library is used to pretty-print any error messages returned by Graph.</span></span> <span data-ttu-id="7ffe9-121">(Wenn Sie zum Beispiel eine ungültige E-Mail-Adresse als Empfänger verwenden.)</span><span class="sxs-lookup"><span data-stu-id="7ffe9-121">(For example, if you try to send to an invalid email address.)</span></span>
* <span data-ttu-id="7ffe9-122">Das **uuid**-Modul aus der Standardbibliothek wird zum Generieren einer zufälligen Zeichenfolge aus 36 Zeichen verwendet, um jede Graph-Anforderung eindeutig zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-122">The **uuid** module from the standard library is used to generate a random 36-character string to uniquely identify each Graph request.</span></span> <span data-ttu-id="7ffe9-123">Dies kann für das Debuggen nützlich sein.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-123">This can be useful for debugging purposes.</span></span>
* <span data-ttu-id="7ffe9-124">Das **flask**-Paket ist das Webframework für das Beispiel.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-124">The **flask** package is the web framework for the sample.</span></span>
* <span data-ttu-id="7ffe9-125">Die **OAuth**-Klasse von **flask_oauthlib.client** ist ein Wrapper um die Flask-App herum, die den OAuth 2.0-Authentifizierungsworkflow implementiert.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-125">The **OAuth** class of **flask_oauthlib.client** is a wrapper around the Flask app that implements the OAuth 2.0 authentication workflow.</span></span>
* <span data-ttu-id="7ffe9-126">Das **config**-Modul enthält die Einstellungen für die Anwendungsregistrierung, wie im obigen Installationsprozess konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-126">The **config** module contains the application registration settings, as configured in the installation process above.</span></span>

<span data-ttu-id="7ffe9-127">Als Nächstes [erstellen wir eine Flask-App](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L13-L15) und dann das [Graph-Clientobjekt](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L17-L26) namens **MSGRAPH**.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-127">Next, we [create a Flask app](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L13-L15) and then create the [Graph client object](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L17-L26), named **MSGRAPH**.</span></span>

<span data-ttu-id="7ffe9-128">Nach diesen ersten Einrichtungsschritten kommen drei Flask-Routenhandlerfunktionen, die den Authentifizierungsworkflow implementieren: [homepage()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L28-L31), [login()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L33-L37) und [authorized()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L39-L46).</span><span class="sxs-lookup"><span data-stu-id="7ffe9-128">After those initial setup steps come three Flask route handler functions that implement the authentication workflow: [homepage()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L28-L31), [login()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L33-L37), and [authorized()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L39-L46).</span></span> <span data-ttu-id="7ffe9-129">Weitere Informationen zum Authentifizierungsworkflow finden Sie im Abschnitt [Beispielarchitektur](https://github.com/microsoftgraph/python-sample-auth#sample-architecture) des Repositorys der Python-Authentifizierungsbeispiele.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-129">For more information about the authentication workflow, see the [Sample architecture](https://github.com/microsoftgraph/python-sample-auth#sample-architecture) section of the Python authentication samples repo.</span></span>

<span data-ttu-id="7ffe9-130">Der nächste Routenhandler, [mailform()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L48-L54), ist das Formular, in dem Sie die E-Mail-Empfänger, den Betreff und den Text angeben.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-130">The next route handler, [mailform()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L48-L54), is the form where you specify email recipients, subject, and body.</span></span> <span data-ttu-id="7ffe9-131">Beachten Sie, dass diese Funktion auch unseren ersten Aufruf von Graph umfasst: [Abrufen des Benutzerprofils](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L51-L51), um den Anzeigenamen und die E-Mail-Adresse des aktuellen Benutzers zu erhalten, die an die [mailform.html-Vorlage übergeben werden](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L52-L54).</span><span class="sxs-lookup"><span data-stu-id="7ffe9-131">Note that this function also includes our first call to Graph: [retrieving the user profile](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L51-L51) to get the current user's display name and email address, which are [passed to the mailform.html template](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L52-L54).</span></span>

<span data-ttu-id="7ffe9-132">Als Nächstes kommt die [send_mail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L56-L73)-Funktion, die die E-Mail sendet und die Antwort von der Graph-API anzeigt.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-132">Next is the [send_mail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L56-L73) function, which sends the email and displays the response from the Graph API.</span></span> <span data-ttu-id="7ffe9-133">Diese verwendet eine sendmail()-Hilfsfunktion und übergibt diese an die Abfragezeichenfolgenparameter, die aus dem Formular veröffentlicht wurden:</span><span class="sxs-lookup"><span data-stu-id="7ffe9-133">It uses a sendmail() helper function, passing to it the query string parameters that were posted from the form:</span></span>

```python
response = sendmail(MSGRAPH,
                    subject=flask.request.args['subject'],
                    recipients=flask.request.args['email'].split(';'),
                    html=flask.request.args['body'])
```

<span data-ttu-id="7ffe9-134">Die [get_token()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L75-L78)-Funktion wird von der Flask-OAuthlib-Clientistanz (```MSGRAPH```) verwendet, um immer dann ein Zugriffstoken abzurufen, wenn wir Aufrufe an Graph ausführen.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-134">The [get_token()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L75-L78) function is used by the Flask-OAuthlib client instance (```MSGRAPH```) to obtain an access token whenever we make calls to Graph.</span></span> <span data-ttu-id="7ffe9-135">Das Zugriffstoken wird in einem HTTP-Header mit dem Namen **Authorization** übergeben, Sie müssen sich darum aber in Ihrem Code nicht kümmern.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-135">The access token is passed in an HTTP header named **Authorization**, but you don't need to deal with this in your code.</span></span> <span data-ttu-id="7ffe9-136">Führen Sie einfach Anrufe von Graph über die HTTP-Verb-Methoden des Clients (z. B. get() oder post()) aus; die Clientinstanz weiß dann, dass ```get_token()``` aufgerufen werden muss, um ein Token zu erhalten, da die Funktion ```tokengetter``` [aufweist](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L75-L75).</span><span class="sxs-lookup"><span data-stu-id="7ffe9-136">You can simply make calls to Graph via the client's HTTP verb methods (for example, get() or post()), and the client instance will know to call ```get_token()``` to obtain a token, because the function is [decorated](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L75-L75) with ```tokengetter```.</span></span>

<span data-ttu-id="7ffe9-137">Als Nächstes kommt [request_headers()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L80-L85), wodurch ein Wörterbuch von HTTP-Headern zurückgegeben wird, die mit jedem Aufruf von Graph gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-137">Next comes [request_headers()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L80-L85), which returns a dictionary of HTTP headers that are sent with each call to Graph.</span></span>

<span data-ttu-id="7ffe9-138">Zuletzt kommt [sendmail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L87-L129), die Hilfsfunktion zum Senden von E-Mails.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-138">Finally we have [sendmail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L87-L129), the helper function for sending email.</span></span> <span data-ttu-id="7ffe9-139">Die Nachricht wird mithilfe des ```me/microsoft.graph.sendMail```-Endpunkts in der Microsoft Graph-API gesendet, und Sie können diese Funktion in Ihrem eigenen Code wiederverwenden, wenn Sie E-Mails über Microsoft Graph senden müssen.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-139">It sends a message using the ```me/microsoft.graph.sendMail``` endpoint in the Microsoft Graph API, and you can re-use this function in your own code whenever you need to send email via Microsoft Graph.</span></span> <span data-ttu-id="7ffe9-140">Unter [docstring](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L88-L97) finden Sie Informationen dazu, wie diese Funktion aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-140">See the [docstring](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L88-L97) for information about how to call this function.</span></span>

## <a name="other-python-rest-samples"></a><span data-ttu-id="7ffe9-141">Weitere Python-REST-Beispiele</span><span class="sxs-lookup"><span data-stu-id="7ffe9-141">Other Python REST samples</span></span>

<span data-ttu-id="7ffe9-142">Zusätzlich zu dem oben behandelten Beispiel wird in den folgenden Beispielen veranschaulicht, wie mit anderen Features von Microsoft Graph aus Python gearbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-142">In addition to the sample covered above, the following samples demonstrate how to work with other features of Microsoft Graph from Python:</span></span>

* [<span data-ttu-id="7ffe9-143">Python-Authentifizierungsbeispiele für Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="7ffe9-143">Python authentication samples for Microsoft Graph</span></span>](https://github.com/microsoftgraph/python-sample-auth)
* [<span data-ttu-id="7ffe9-144">Arbeiten mit paginierten Microsoft Graph-Antworten in Python</span><span class="sxs-lookup"><span data-stu-id="7ffe9-144">Working with paginated Microsoft Graph responses in Python</span></span>](https://github.com/microsoftgraph/python-sample-pagination)
* [<span data-ttu-id="7ffe9-145">Arbeiten mit offenen Graph-Erweiterungen in Python</span><span class="sxs-lookup"><span data-stu-id="7ffe9-145">Working with Graph open extensions in Python</span></span>](https://github.com/microsoftgraph/python-sample-open-extensions)

<span data-ttu-id="7ffe9-146">Wenn Sie nach einem bestimmten Beispiel suchen, teilen Sie uns das mit, indem Sie uns [ein Problem übermitteln](https://github.com/microsoftgraph/python-sample-auth/issues).</span><span class="sxs-lookup"><span data-stu-id="7ffe9-146">If there's a particular sample you'd like to see, please let us know by [submitting an issue](https://github.com/microsoftgraph/python-sample-auth/issues).</span></span> <span data-ttu-id="7ffe9-147">Wir schätzen Ihr Feedback zu allen Microsoft Graph-Szenarien, die Sie in Python entwickeln möchten!</span><span class="sxs-lookup"><span data-stu-id="7ffe9-147">We're very interested in your feedback on any Microsoft Graph scenario you'd like to build in Python!</span></span>

<span data-ttu-id="7ffe9-148">Die Microsoft Graph-API ist eine leistungsfähige einheitliche API, die für die Interaktion mit beliebigen Microsoft-Daten verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-148">The Microsoft Graph API is a very powerful, unifiying API that can be used to interact with all kinds of Microsoft data. Check out the API reference to explore what else you can accomplish with Microsoft Graph.</span></span> <span data-ttu-id="7ffe9-149">Schauen Sie sich die [Entwicklerdokumentationen](https://developer.microsoft.com/de-DE/graph/docs/concepts/overview) oder den [Graph-Explorer](https://developer.microsoft.com/de-DE/graph/graph-explorer) an, um sich von den Vorteilen von Microsoft Graph zu überzeugen.</span><span class="sxs-lookup"><span data-stu-id="7ffe9-149">Check out the [developer documentation](https://developer.microsoft.com/de-DE/graph/docs/concepts/overview) or the [Graph Explorer](https://developer.microsoft.com/de-DE/graph/graph-explorer) to explore what else you can accomplish with Microsoft Graph.</span></span>
