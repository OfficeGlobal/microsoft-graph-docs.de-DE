#  <a name="use-delta-query-to-track-changes-in-microsoft-graph-data"></a><span data-ttu-id="09d72-101">Verwenden einer Delta-Abfrage zum Nachverfolgen von Änderungen in Microsoft Graph-Daten</span><span class="sxs-lookup"><span data-stu-id="09d72-101">Use delta query to track changes in Microsoft Graph data</span></span>

<span data-ttu-id="09d72-p101">Mit der Delta-Abfrage können Anwendungen neu erstellte, aktualisierte oder gelöschte Entitäten ermitteln, ohne die Zielressource bei jeder Anforderung vollständig lesen zu müssen. Mit der Delta-Abfrage können Microsoft Graph-Anwendungen Änderungen effizient mit einem lokalen Datenspeicher synchronisieren.</span><span class="sxs-lookup"><span data-stu-id="09d72-p101">Delta query enables applications to discover newly created, updated, or deleted entities without performing a full read of the target resource with every request. Microsoft Graph applications can use delta query to efficiently synchronize changes with a local data store.</span></span>

## <a name="use-delta-query-to-track-changes-in-a-resource-collection"></a><span data-ttu-id="09d72-104">Verwenden einer Delta-Abfrage zum Nachverfolgen von Änderungen in einer Ressourcensammlung</span><span class="sxs-lookup"><span data-stu-id="09d72-104">Use delta query to track changes in a resource collection</span></span>

<span data-ttu-id="09d72-105">Das typische Abrufmuster sieht folgendermaßen aus:</span><span class="sxs-lookup"><span data-stu-id="09d72-105">The typical call pattern is as follows:</span></span>

1.  <span data-ttu-id="09d72-106">Die Anwendung ruft zunächst eine GET-Anforderung mit der Delta-Funktion für die gewünschte Ressource auf.</span><span class="sxs-lookup"><span data-stu-id="09d72-106">The application begins by calling a GET request with the delta function on the desired resource.</span></span>
2.  <span data-ttu-id="09d72-107">Microsoft Graph sendet dann eine Antwort mit der angeforderten Ressource und einem [Statustoken](#state-tokens).</span><span class="sxs-lookup"><span data-stu-id="09d72-107">Microsoft Graph sends a response containing the requested resource and a [state token](#state-tokens).</span></span>

     <span data-ttu-id="09d72-p102">a.  Wenn eine `nextLink`-URL zurückgegeben wird, müssen eventuell zusätzliche Seiten mit Daten in der Sitzung abgerufen werden. Die Anwendung nimmt weiterhin Anforderungen über die `nextLink`-URL vor, um alle Seiten mit Daten abzurufen, bis eine `deltaLink`-URL in der Antwort zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="09d72-p102">a.  If a `nextLink` URL is returned, there may be additional pages of data to be retrieved in the session. The application continues making requests using the `nextLink` URL to retrieve all pages of data until a `deltaLink` URL is returned in the response.</span></span>

     <span data-ttu-id="09d72-p103">b.  Wenn eine `deltaLink`-URL zurückgegeben wird, gibt es keine weiteren Daten über den derzeitigen Status der zurückzugebenden Ressource. Für zukünftige Anforderungen verwendet die Anwendung die `deltaLink`-URL, um Informationen zu Änderungen an der Ressource zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="09d72-p103">b.  If a `deltaLink` URL is returned, there is no more data about the existing state of the resource to be returned. For future requests, the application uses the `deltaLink` URL to learn about changes to the resource.</span></span>

3.  <span data-ttu-id="09d72-p104">Wenn die Anwendung Informationen zu Änderungen an der Ressource benötigt, nimmt sie eine neue Anforderung mit der in Schritt 2 erhaltenen `deltaLink`-URL vor. Diese Anforderung *kann* umgehend nach Abschluss von Schritt 2 oder bei der Prüfung auf Änderungen durch die Anwendung vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="09d72-p104">When the application needs to learn about changes to the resource, it makes a new request using the `deltaLink` URL received in step 2. This request *may* be made immediately after completing step 2 or when the application checks for changes.</span></span>
4.  <span data-ttu-id="09d72-116">Microsoft Graph gibt eine Antwort, in der die seit der vorherigen Anforderung an der Ressource vorgenommenen Änderungen beschrieben werden, sowie eine `nextLink`-URL oder eine `deltaLink`-URL zurück.</span><span class="sxs-lookup"><span data-stu-id="09d72-116">Microsoft Graph returns a response describing changes to the resource since the previous request, and either a `nextLink` URL or a `deltaLink` URL.</span></span>

### <a name="state-tokens"></a><span data-ttu-id="09d72-117">Statustoken</span><span class="sxs-lookup"><span data-stu-id="09d72-117">State tokens</span></span>

<span data-ttu-id="09d72-p105">Eine GET-Antwort einer Delta-Abfrage umfasst immer eine URL, die in einem `nextLink`- oder `deltaLink`-Antwortheader angegeben ist. Die `nextLink`-URL umfasst ein _skipToken_, und eine `deltaLink`-URL umfasst ein _deltaToken_.</span><span class="sxs-lookup"><span data-stu-id="09d72-p105">A delta query GET response always includes a URL specified in a `nextLink` or `deltaLink` response header. The `nextLink` URL includes a _skipToken_, and a `deltaLink` URL includes a _deltaToken_.</span></span>

<span data-ttu-id="09d72-p106">Diese Token sind für den Client nicht transparent. Nachfolgend finden Sie alles, was Sie darüber wissen müssen:</span><span class="sxs-lookup"><span data-stu-id="09d72-p106">These tokens are opaque to the client. The following details are what you need to know about them:</span></span>

- <span data-ttu-id="09d72-122">Jedes Token gibt den Status an und ist eine Momentaufnahme der Ressource in dieser Runde der Änderungsnachverfolgung.</span><span class="sxs-lookup"><span data-stu-id="09d72-122">Each token reflects the state and represents a snapshot of the resource in that round of change tracking.</span></span>
- <span data-ttu-id="09d72-p107">Die Statustoken codieren und umfassen auch andere Abfrageparameter (z. B. `$select`), die in der anfänglichen Delta-Abfrageanforderung angegeben sind. Es ist daher nicht erforderlich, diese in nachfolgenden Delta-Abfrageanforderungen zu wiederholen.</span><span class="sxs-lookup"><span data-stu-id="09d72-p107">The state tokens also encode and include other query parameters (such as `$select`) specified in the initial delta query request. Therefore, it's not required to repeat them in subsequent delta query requests.</span></span>
- <span data-ttu-id="09d72-125">Beim Ausführen von Delta-Abfragen können Sie die `nextLink`- oder `deltaLink`-URL kopieren und auf den nächsten **delta**-Funktionsaufruf anwenden, ohne den Inhalt der URL, einschließlich ihres Statustoken, zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="09d72-125">When carrying out delta query, you can copy and apply the `nextLink` or `deltaLink` URL to the next **delta** function call without having to inspect the contents of the URL, including its state token.</span></span>


### <a name="optional-query-parameters"></a><span data-ttu-id="09d72-126">Optionale Abfrageparameter</span><span class="sxs-lookup"><span data-stu-id="09d72-126">Optional query parameters</span></span>

<span data-ttu-id="09d72-p108">Wenn ein Client einen Abfrageparameter verwendet, muss dieser in der ursprünglichen Anforderung angegeben sein. Microsoft Graph codiert automatisch den angegebenen Parameter in den in der Antwort enthaltenen `nextLink` oder `deltaLink`. Die aufrufende Anwendung muss die gewünschten Abfrageparameter nur einmal im Vorfeld angeben. Microsoft Graph fügt die angegebenen Parameter automatisch für alle nachfolgenden Anforderungen hinzu.</span><span class="sxs-lookup"><span data-stu-id="09d72-p108">If a client uses a query parameter, it must be specified in the initial request. Microsoft Graph automatically encodes the specified parameter into the `nextLink` or `deltaLink` provided in the response. The calling application only needs to specify their desired query parameters once upfront. Microsoft Graph adds the specified parameters automatically for all subsequent requests.</span></span>

<span data-ttu-id="09d72-131">Für Benutzer und Gruppen gibt es Einschränkungen im Hinblick auf die Verwendung einiger Abfrageparameter:</span><span class="sxs-lookup"><span data-stu-id="09d72-131">For users and groups, there are restrictions on using some query parameters:</span></span>

-   <span data-ttu-id="09d72-p109">Wenn ein `$select`-Abfrageparameter verwendet wird, bedeutet dies, dass der Client nur Änderungen an den Eigenschaften oder Beziehungen nachverfolgen möchte, die in der `$select`-Anweisung angegeben sind. Wenn eine Änderung an einer nicht ausgewählten Eigenschaft vorgenommen wird, wird die Ressource, für die diese Eigenschaft geändert wurde, nach einer nachfolgenden Anforderung nicht in der Delta-Antwort angezeigt.</span><span class="sxs-lookup"><span data-stu-id="09d72-p109">If a `$select` query parameter is used, the parameter indicates that the client prefers to only track changes on the properties or relationships specified in the `$select` statement. If a change occurs to a property that is not selected, the resource for which that property changed does not appear in the delta response after a subsequent request.</span></span>
-   <span data-ttu-id="09d72-134">`$expand` wird nur für die Navigationseigenschaften `manager` und `members` jeweils für Benutzer und Gruppen unterstützt.</span><span class="sxs-lookup"><span data-stu-id="09d72-134">`$expand` is only suported for the `manager` and `members` navigational property for users and groups respectively.</span></span>

<span data-ttu-id="09d72-p110">APIs für Benutzer und Gruppen können Sie mithilfe von Bereichsfiltern Änderungen an einem oder mehreren bestimmten Benutzern bzw. einer oder mehreren bestimmten Gruppen nach objectId nachverfolgen. Die folgende Anforderung gibt beispielsweise Änderungen für die Gruppen zurück, die mit den im Abfragefilter angegebenen IDs übereinstimmen: https://graph.microsoft.com/beta/groups/delta/?$filter= id eq '477e9fc6-5de7-4406-bb2a-7e5c83c9ae5f' oder id eq '004d6a07-fe70-4b92-add5-e6e37b8acd8e'.</span><span class="sxs-lookup"><span data-stu-id="09d72-p110">For users and groups APIs, scoping filters allow you to track changes to one or more specific users or groups by objectId. For example, the following request: https://graph.microsoft.com/beta/groups/delta/?$filter= id eq '477e9fc6-5de7-4406-bb2a-7e5c83c9ae5f' or id eq '004d6a07-fe70-4b92-add5-e6e37b8acd8e' returns changes for the groups matching the ids specified in the query filter.</span></span>

## <a name="resource-representation-in-the-delta-query-response"></a><span data-ttu-id="09d72-137">Ressourcendarstellung in der Delta-Abfrageantwort</span><span class="sxs-lookup"><span data-stu-id="09d72-137">Resource representation in the delta query response</span></span>

-   <span data-ttu-id="09d72-138">Neu erstellte Instanzen einer unterstützten Ressourcen werden in der Delta-Abfrageantwort mithilfe ihrer standardmäßigen Darstellung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="09d72-138">Newly created instances of a supported resource are represented in the delta query response using their standard representation.</span></span>

-   <span data-ttu-id="09d72-139">Aktualisierte Instanzen werden anhand ihrer **ID** mit *mindestens* den Eigenschaften dargestellt, die aktualisiert wurden. Es können aber auch weitere Eigenschaften eingeschlossen werden.</span><span class="sxs-lookup"><span data-stu-id="09d72-139">Updated instances are represented by their **id** with *at least* the properties that have been updated, but additional properties may be included.</span></span>

-   <span data-ttu-id="09d72-p111">Beziehungen für Benutzer und Gruppen werden als Anmerkungen in der standardmäßigen Ressourcendarstellung dargestellt. Diese Anmerkungen haben das Format `propertyName@delta`. Die Anmerkungen sind in der Antwort auf die erste Delta-Abfrageanforderung enthalten.</span><span class="sxs-lookup"><span data-stu-id="09d72-p111">Relationships on users and groups are represented as annotations on the standard resource representation. These annotations use the format `propertyName@delta`. The annotations are included in the response of the initial delta query request.</span></span>

<span data-ttu-id="09d72-p112">Entfernte Instanzen werden durch ihre **ID** und ein `@removed`-Objekt dargestellt. Das `@removed`-Objekt kann zusätzliche Informationen zum Grund der Entfernung der Instanz enthalten. Beispiel: "@removed": {"reason": "changed"}.</span><span class="sxs-lookup"><span data-stu-id="09d72-p112">Removed instances are represented by their **id** and an `@removed` object. The `@removed` object may include additional information about why the instance was removed. For example,  "@removed": {"reason": “changed”}.</span></span>

<span data-ttu-id="09d72-146">Mögliche @removed-Gründe sind *changed* und *deleted*.</span><span class="sxs-lookup"><span data-stu-id="09d72-146">Possible @removed reasons can be *changed* or *deleted*.</span></span>
- <span data-ttu-id="09d72-147">*Changed* gibt an, dass das Element gelöscht wurde und aus [deletedItems](../api-reference/beta/resources/directory.md) wiederhergestellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="09d72-147">*Changed* indicates the item was deleted and can be restored from [deletedItems](../api-reference/beta/resources/directory.md).</span></span>
- <span data-ttu-id="09d72-148">*Deleted* gibt an, dass das Element gelöscht wurde und nicht wiederhergestellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="09d72-148">*Deleted* indicates the item is deleted and cannot be restored.</span></span>

<span data-ttu-id="09d72-p113">Das `@removed`-Objekt kann in der Antwort auf die erste Delta-Abfrage und in nachverfolgten (deltaLink-)Antworten zurückgegeben werden. Clients, die Delta-Abfrageanforderungen verwenden, sollten so konzipiert sein, dass sie diese Objekte in den Antworten behandeln.</span><span class="sxs-lookup"><span data-stu-id="09d72-p113">The `@removed` object can be returned in the initial delta query response and in tracked (deltaLink) responses. Clients using delta query requests should be designed to handle these objects in the responses.</span></span>

## <a name="supported-resources"></a><span data-ttu-id="09d72-151">Unterstützte Ressourcen</span><span class="sxs-lookup"><span data-stu-id="09d72-151">Supported resources</span></span>

<span data-ttu-id="09d72-152">Die Delta-Abfrage wird derzeit für die folgenden Ressourcen unterstützt:</span><span class="sxs-lookup"><span data-stu-id="09d72-152">Delta query is currently supported for the following resources.</span></span>

| <span data-ttu-id="09d72-153">**Ressourcensammlung**</span><span class="sxs-lookup"><span data-stu-id="09d72-153">**Resource collection**</span></span> | <span data-ttu-id="09d72-154">**API**</span><span class="sxs-lookup"><span data-stu-id="09d72-154">**API**</span></span> |
|:------ | :------ |
| <span data-ttu-id="09d72-155">Ereignisse in einer Kalenderansicht (Datumsbereich) des primären Kalenders</span><span class="sxs-lookup"><span data-stu-id="09d72-155">Events in a calendar view (date range) of the primary calendar</span></span> | <span data-ttu-id="09d72-156">[Delta](../api-reference/v1.0/api/event_delta.md)-Funktion der [event](../api-reference/v1.0/resources/event.md)-Ressource</span><span class="sxs-lookup"><span data-stu-id="09d72-156">[delta](../api-reference/v1.0/api/event_delta.md) function of the [event](../api-reference/v1.0/resources/event.md) resource</span></span> |
| <span data-ttu-id="09d72-157">Gruppen</span><span class="sxs-lookup"><span data-stu-id="09d72-157">Groups</span></span> | <span data-ttu-id="09d72-158">[Delta](../api-reference/v1.0/api/group_delta.md)-Funktion der [group](../api-reference/v1.0/resources/group.md)-Ressource</span><span class="sxs-lookup"><span data-stu-id="09d72-158">[delta](../api-reference/v1.0/api/group_delta.md) function of the [group](../api-reference/v1.0/resources/group.md) resource</span></span> |
| <span data-ttu-id="09d72-159">E-Mail-Ordner</span><span class="sxs-lookup"><span data-stu-id="09d72-159">Mail folders</span></span> | <span data-ttu-id="09d72-160">[Delta](../api-reference/v1.0/api/mailfolder_delta.md)-Funktion der [mailFolder](../api-reference/v1.0/resources/mailFolder.md)-Ressource</span><span class="sxs-lookup"><span data-stu-id="09d72-160">[delta](../api-reference/v1.0/api/mailfolder_delta.md) function of the [mailFolder](../api-reference/v1.0/resources/mailFolder.md) resource</span></span> |
| <span data-ttu-id="09d72-161">Nachrichten in einem Ordner</span><span class="sxs-lookup"><span data-stu-id="09d72-161">Messages in a folder</span></span> | <span data-ttu-id="09d72-162">[Delta](../api-reference/v1.0/api/message_delta.md)-Funktion der [message](../api-reference/v1.0/resources/message.md)-Ressource</span><span class="sxs-lookup"><span data-stu-id="09d72-162">[delta](../api-reference/v1.0/api/message_delta.md) function of the [message](../api-reference/v1.0/resources/message.md) resource</span></span> |
| <span data-ttu-id="09d72-163">Ordner mit persönlichen Kontakten</span><span class="sxs-lookup"><span data-stu-id="09d72-163">Personal contact folders</span></span> | <span data-ttu-id="09d72-164">[Delta](../api-reference/v1.0/api/contactfolder_delta.md)-Funktion der [contactFolder](../api-reference/v1.0/resources/contactfolder.md)-Ressource</span><span class="sxs-lookup"><span data-stu-id="09d72-164">[delta](../api-reference/v1.0/api/contactfolder_delta.md) function of the [contactFolder](../api-reference/v1.0/resources/contactfolder.md) resource</span></span> |
| <span data-ttu-id="09d72-165">Persönliche Kontakte in einem Ordner</span><span class="sxs-lookup"><span data-stu-id="09d72-165">Personal contacts in a folder</span></span> | <span data-ttu-id="09d72-166">[Delta](../api-reference/v1.0/api/contact_delta.md)-Funktion der [contact](../api-reference/v1.0/resources/contact.md)-Ressource</span><span class="sxs-lookup"><span data-stu-id="09d72-166">[delta](../api-reference/v1.0/api/contact_delta.md) function of the [contact](../api-reference/v1.0/resources/contact.md) resource</span></span> |
| <span data-ttu-id="09d72-167">Benutzer</span><span class="sxs-lookup"><span data-stu-id="09d72-167">Users</span></span> | <span data-ttu-id="09d72-168">[Delta](../api-reference/v1.0/api/user_delta.md)-Funktion der [user](../api-reference/v1.0/resources/user.md)-Ressource</span><span class="sxs-lookup"><span data-stu-id="09d72-168">[delta](../api-reference/v1.0/api/user_delta.md) function of the [user](../api-reference/v1.0/resources/user.md) resource</span></span> |
| <span data-ttu-id="09d72-169">Laufwerk-Elemente\*</span><span class="sxs-lookup"><span data-stu-id="09d72-169">Drive items\*</span></span> | <span data-ttu-id="09d72-170">[Delta](../api-reference/v1.0/api/driveitem_delta.md)-Funktion der [driveItem](../api-reference/v1.0/resources/driveitem.md)-Ressource</span><span class="sxs-lookup"><span data-stu-id="09d72-170">[delta](../api-reference/v1.0/api/driveitem_delta.md) function of the [driveItem](../api-reference/v1.0/resources/driveitem.md) resource</span></span> |
| <span data-ttu-id="09d72-171">Planner-Elemente\*\*</span><span class="sxs-lookup"><span data-stu-id="09d72-171">Planner items\*\*</span></span> | <span data-ttu-id="09d72-172">[Delta](../api-reference/beta/api/planneruser_list_delta.md)-Funktion des all-Segments der [plannerUser](../api-reference/beta/resources/planneruser.md)-Ressource (Vorschau)</span><span class="sxs-lookup"><span data-stu-id="09d72-172">[delta](../api-reference/beta/api/planneruser_list_delta.md) function of the all segment of [plannerUser](../api-reference/beta/resources/planneruser.md) resource (preview)</span></span> |

> <span data-ttu-id="09d72-p114">\* Das Verwendungsmuster für OneDrive-Ressourcen ähnelt dem der anderen unterstützten Ressourcen, mit geringen Unterschieden in der Syntax. Die Delta-Abfrage für Laufwerke wird zwecks Konsistenz mit anderen Ressourcentypen demnächst aktualisiert. Weitere Informationen zur aktuellen Syntax finden Sie unter[Laufwerksänderungen nachverfolgen](https://developer.microsoft.com/de-DE/graph/docs/api-reference/v1.0/api/item_delta).</span><span class="sxs-lookup"><span data-stu-id="09d72-p114">\* The usage pattern for OneDrive resources is similar to the other supported resources with some minor syntax differences. Delta query for drives will be updated in the future to be consistent with other resource types. For more detail about the current syntax, see [Track changes for a Drive](https://developer.microsoft.com/de-DE/graph/docs/api-reference/v1.0/api/item_delta).</span></span>

> <span data-ttu-id="09d72-176">\*\* Das Verwendungsmuster für Planner-Ressourcen ähnelt anderen unterstützten Ressourcen bis auf ein paar Unterschiede.</span><span class="sxs-lookup"><span data-stu-id="09d72-176">\*\* The usage pattern for Planner resources is similar to other supported resources with a few differences.</span></span>  <span data-ttu-id="09d72-177">Weitere Informationen finden Sie unter [Änderungen für Planner nachverfolgen](../api-reference/beta/api/planneruser_list_delta.md).</span><span class="sxs-lookup"><span data-stu-id="09d72-177">For details, see [Track changes for Planner](../api-reference/beta/api/planneruser_list_delta.md).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="09d72-178">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="09d72-178">Prerequisites</span></span>

<span data-ttu-id="09d72-179">Dieselben [Berechtigungen](./permissions_reference.md), die zum Lesen einer bestimmten Ressource erforderlich sind, werden auch zur Durchführung der Delta-Abfrage für diese Ressource benötigt.</span><span class="sxs-lookup"><span data-stu-id="09d72-179">The same [permissions](./permissions_reference.md) that are required to read a specific resource are also required to perform delta query on that resource.</span></span>

## <a name="delta-query-request-examples"></a><span data-ttu-id="09d72-180">Beispiele für die Delta-Abfrageanforderung</span><span class="sxs-lookup"><span data-stu-id="09d72-180">Delta query request examples</span></span>

- [<span data-ttu-id="09d72-181">Inkrementelle Änderungen an Ereignissen in einer Kalenderansicht abrufen</span><span class="sxs-lookup"><span data-stu-id="09d72-181">Get incremental changes to events in a calendar view</span></span>](../concepts/delta_query_events.md)
- [<span data-ttu-id="09d72-182">Inkrementelle Änderungen an Nachrichten in einem Ordner abrufen</span><span class="sxs-lookup"><span data-stu-id="09d72-182">Get incremental changes to messages in a folder</span></span>](./delta_query_messages.md)
- [<span data-ttu-id="09d72-183">Inkrementelle Änderungen an Gruppen abrufen</span><span class="sxs-lookup"><span data-stu-id="09d72-183">Get incremental changes to groups</span></span>](./delta_query_groups.md)
- [<span data-ttu-id="09d72-184">Inkrementelle Änderungen an Benutzern abrufen</span><span class="sxs-lookup"><span data-stu-id="09d72-184">Get incremental changes to users</span></span>](./delta_query_users.md)
